<div>
  <h2>{{ 'headings.relayControls' | translate }}</h2>
</div>

<div class="divCenterOuter">
  {{ 'headings.relayControlsInfo' | translate }}
</div>

<br/>
<br/>

<div>
  <h3>{{ 'headings.relayControlsAdd' | translate }}</h3>
</div>

<div class="divCenterOuter">
  <form #form="ngForm" [formGroup]="formGroup" (ngSubmit)="submitForm(formGroup.value)">

    <mat-form-field style="width:19em">
      <mat-select (selectionChange)="optionSelected($event)" placeholder="{{ 'forms.settings.relayControls.placeholderRelayName' | translate }}" formControlName="relayName" id="relayName" required>
        @for (opt of disconnectControlOptions; track opt) {
          <mat-option [value]="{ nameLabel:opt.label, nameObisCode:opt.obisCode }">
            {{ opt.serie }}
          </mat-option>
        }
      </mat-select>
      <mat-hint align="end">{{ 'forms.settings.relayControls.hintRelayName' | translate }}</mat-hint>
      @if (hasError('relayName', 'required')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.required' | translate }}</mat-error>
      }
    </mat-form-field>

    <br/>

    <mat-form-field style="width:19em">
      <mat-select (selectionChange)="optionSelected($event)" placeholder="{{ 'forms.settings.relayControls.placeholderSerieName' | translate }}" formControlName="serieName" id="serieName" required>
        @for (opt of evaluationSerieOptions; track opt) {
          <mat-option [value]="{ evaluationLabel:opt.label, evaluationObisCode:opt.obisCode, unit:opt.unit }">
            {{ opt.serie }}
          </mat-option>
        }
      </mat-select>
      <mat-hint align="end">{{ 'forms.settings.relayControls.hintSerieName' | translate }}</mat-hint>
      @if (hasError('serieName', 'required')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.required' | translate }}</mat-error>
      }
    </mat-form-field>

    <br/>

    <mat-form-field style="width:19em">
      <mat-select (selectionChange)="optionSelected($event)" placeholder="{{ 'forms.settings.relayControls.placeholderDuration' | translate }}" formControlName="durationMinutes" id="durationMinutes" required>
        @for (opt of durationMinuteOptions; track opt) {
          <mat-option [value]="opt">
            {{ opt }} {{ 'forms.settings.relayControls.minutes' | translate }}
          </mat-option>
        }
      </mat-select>
      <mat-hint align="end">{{ 'forms.settings.relayControls.hintDuration' | translate }}</mat-hint>
      @if (hasError('durationMinutes', 'required')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.required' | translate }}</mat-error>
      }
    </mat-form-field>

    <br/>

    <mat-form-field style="width:19em">
      <input matInput type="number" (change)="inputChanged($event)" (keyup)="inputChanged($event)" placeholder="{{ 'forms.settings.relayControls.placeholderDisconnectToConnectValue' | translate }}" formControlName="disconnectToConnectValue" id="disconnectToConnectValue" required>
      <mat-hint align="end">{{ 'forms.settings.relayControls.hintDisconnectToConnectValue' | translate }}</mat-hint>
      @if (hasError('disconnectToConnectValue', 'required')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.required' | translate }}</mat-error>
      }
      @if (hasError('disconnectToConnectValue', 'min')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.min_1' | translate }}</mat-error>
      }
      @if (hasError('disconnectToConnectValue', 'max')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.max_65535' | translate }}</mat-error>
      }
    </mat-form-field>

    <br/>

    <mat-form-field style="width:19em">
      <input matInput type="number" [errorStateMatcher]="errorMatcher" (change)="inputChanged($event)" (keyup)="inputChanged($event)" placeholder="{{ 'forms.settings.relayControls.placeholderConnectToDisconnectValue' | translate }}" formControlName="connectToDisconnectValue" id="connectToDisconnectValue" required>
      <mat-hint align="end">{{ 'forms.settings.relayControls.hintConnectToDisconnectValue' | translate }}</mat-hint>
      @if (hasError('connectToDisconnectValue', 'required')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.required' | translate }}</mat-error>
      }
      @if (hasError('connectToDisconnectValue', 'min')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.min_1' | translate }}</mat-error>
      }
      @if (hasError('connectToDisconnectValue', 'max')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.max_65535' | translate }}</mat-error>
      }
      @if (formGroup.hasError('valueGreaterThanOrEqual')) {
        <mat-error>{{ 'forms.settings.relayControls.valErrors.mustBeLess' | translate }}</mat-error>
      }
    </mat-form-field>

    <br/>

    <button mat-raised-button style="margin:5px;" type="submit" [disabled]="!formGroup.valid">{{ 'forms.settings.relayControls.buttonAdd' | translate }}</button>

    <br/>

    {{ helpText }}
  </form>

</div>

<br />
<br />

<div class="divCenterOuter">
  <div class="divCenterInner">

    @if (disconnectRuleSet !== undefined && disconnectRuleSet.items.length > 0) {
      <div>
        <app-settings-relay-controls-table [disconnectRuleSet]="disconnectRuleSet"
        (deleteDisconnectRule)="deleteDisconnectRule($event)"></app-settings-relay-controls-table>
      </div>
    }

  </div>
</div>